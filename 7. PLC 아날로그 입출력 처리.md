# 7. PLC 아날로그 입출력 처리

## 7.1 A/D, D/A 변환 원리

*(PLC에서 아날로그 신호를 디지털로, 디지털 신호를 아날로그로 변환하는 핵심 개념)*

------

### ✅ 개요

PLC는 대부분의 제어 연산을 **디지털(0과 1)** 형태로 처리하지만,
 센서나 액추에이터는 **아날로그(연속적인 전압/전류)** 신호를 사용한다.

이를 위해 PLC는 **A/D (Analog to Digital)** 변환기와
 **D/A (Digital to Analog)** 변환기를 통해 서로 다른 신호 체계를 연결한다.

------

### ✅ 1. A/D 변환 (Analog → Digital)

#### 📌 정의

- **아날로그 전압/전류 신호(예: 0~10V, 4~20mA)**를
   PLC 내부에서 처리 가능한 **디지털 수치(예: 0~4095)**로 변환

#### 📌 주요 개념

| 항목            | 설명                                       |
| --------------- | ------------------------------------------ |
| **입력 범위**   | 예: 0~10V, -10~10V, 4~20mA 등              |
| **해상도**      | 몇 비트로 표현하는가? (예: 12bit → 0~4095) |
| **샘플링 주기** | 얼마나 자주 측정하는가? (ms 단위 주기)     |
| **오차**        | 양자화 오차, 비선형성 등                   |

#### 📌 예제: 0~10V 입력, 12bit A/D

| 입력 전압(V) | 디지털 값 (0~4095) |
| ------------ | ------------------ |
| 0V           | 0                  |
| 5V           | 2048               |
| 10V          | 4095               |

→ 디지털 값 = `(입력 전압 / 10V) × 4095`

------

### ✅ 2. D/A 변환 (Digital → Analog)

#### 📌 정의

- PLC 내부의 **디지털 값(예: 0~4095)**을
   **아날로그 전압/전류(예: 0~10V, 4~20mA)** 신호로 변환하여 출력

#### 📌 예제: 0~4095 디지털 값 → 0~10V 아날로그 출력

| 디지털 값 | 출력 전압(V) |
| --------- | ------------ |
| 0         | 0V           |
| 2048      | 5V           |
| 4095      | 10V          |

→ 전압 = `(디지털 값 / 4095) × 10V`

------

### ✅ 3. 비트 수에 따른 해상도 비교

| 해상도 (bit) | 표현 가능한 값의 수 | 최소 분해능 (0~10V 기준) |
| ------------ | ------------------- | ------------------------ |
| 8bit         | 256                 | 10V / 255 ≈ 0.039V       |
| 10bit        | 1024                | 10V / 1023 ≈ 0.0098V     |
| 12bit        | 4096                | 10V / 4095 ≈ 0.0024V     |
| 16bit        | 65536               | 10V / 65535 ≈ 0.00015V   |

→ 비트 수가 많을수록 정밀하게 측정/제어 가능

------

### ✅ 4. 아날로그 신호 타입 비교

| 신호 유형 | 설명      | 장점                        | 단점           |
| --------- | --------- | --------------------------- | -------------- |
| 0~10V     | 전압형    | 저렴하고 간단               | 노이즈에 민감  |
| -10~10V   | 양극 전압 | 방향성 표현 가능            | 간섭 영향 ↑    |
| 4~20mA    | 전류형    | 노이즈 강함, 단선 감지 가능 | 회로 설계 복잡 |
| 1~5V      | 센서 전용 | 저전력, 간단                | 낮은 분해능    |

------

### ✅ 5. PLC 아날로그 모듈 연동

#### 📌 입력

- 센서 → A/D 입력 모듈 (전압/전류 선택)
- 예: 온도센서, 거리센서, 압력센서

#### 📌 출력

- PLC 내부 연산 결과 → D/A 출력 모듈 → 액추에이터
- 예: 인버터 속도 제어, 유량 제어 밸브

------

### ✅ 6. 응용 예

| 분야        | A/D 입력 예 | D/A 출력 예      |
| ----------- | ----------- | ---------------- |
| HVAC        | 온도센서    | 밸브 개도율 제어 |
| 자동화 라인 | 압력센서    | 모터 속도 제어   |
| 정밀기계    | 위치 피드백 | 진동 제어 시스템 |
| 수처리      | 수위 센서   | 펌프 제어        |

------

### ✅ 7. 설계 시 주의사항

- **입력 전압 범위**와 **센서 출력 범위**가 일치하는지 확인
- **신호 노이즈 제거**를 위해 쉴딩, 필터 사용
- 전류 신호는 **단선 감지 가능성**이 있으므로 신뢰성 ↑
- **이중 절연 설계**로 PLC 보호

------

### ✅ 정리

- **A/D 변환**은 연속적인 센서 값을 PLC에서 처리 가능한 수치로 변환
- **D/A 변환**은 연산 결과를 아날로그 액추에이터에 전달
- 해상도(Bit 수), 입력 범위, 샘플링 주기 등을 고려해 설계
- 전압 vs 전류 신호는 상황에 따라 선택

## 7.2 전류 루프(4-20mA), 전압 입력(0-10V)

*(PLC에서 가장 널리 사용되는 아날로그 입력 방식의 구조와 차이)*

------

### ✅ 개요

센서의 아날로그 출력은 PLC의 아날로그 입력 모듈에 전달되어 처리된다.
 그때 사용하는 대표적인 입력 방식은 다음 두 가지다:

- **전류 루프(Current Loop)**: 4~20mA
- **전압 입력(Voltage Input)**: 0~10V, -10~10V, 1~5V 등

각 방식은 **전기적 특성, 신뢰성, 노이즈 내성, 거리 제약** 등에서 차이가 있으며
 **현장 조건에 맞춰 적절히 선택해야 한다.**

------

### ✅ 1. 전류 루프 (4~20mA)

------

#### 📌 개념

- 센서가 **4mA~20mA의 전류를 발생**시키고, PLC는 이 전류 값을 측정함
- **전류**는 회로 내에서 동일하게 흐르므로 **전압 강하나 간섭에 강함**
- 4mA는 **제로값이 아님** → **센서 단선 감지**가 가능

------

#### 📌 특징

| 항목               | 설명                            |
| ------------------ | ------------------------------- |
| **전송 신뢰성**    | 매우 높음 (장거리 가능)         |
| **노이즈 내성**    | 우수                            |
| **배선 수**        | 2선 또는 3선 방식               |
| **센서 단선 감지** | 4mA 미만이면 단선 판단 가능     |
| **거리 영향**      | 작음 (수십~수백 m까지 가능)     |
| **회로 설계**      | 전류 루프 회로 필요 (전원 포함) |

------

#### 📌 예시

| 실제 전류 | 측정된 값 (12bit 기준) |
| --------- | ---------------------- |
| 4mA       | 0                      |
| 12mA      | 2047                   |
| 20mA      | 4095                   |

→ 디지털 값 = `(측정전류 - 4mA) / 16mA × 4095`

------

#### 📘 전류 루프 회로 구성

```
[센서 +24V] ──────┬──────────── PLC AI+
                 │
             [센서 출력]
                 │
[GND]────────────┴──────────── PLC AI-
```

- 센서가 전류를 "끌어당기며" 루프를 형성
- PLC는 이 전류를 측정

------

### ✅ 2. 전압 입력 (0~10V)

------

#### 📌 개념

- 센서가 **0~10V 또는 -10~+10V** 범위의 전압을 출력
- PLC는 입력 모듈의 **전압을 샘플링**하여 디지털로 변환

------

#### 📌 특징

| 항목            | 설명                                   |
| --------------- | -------------------------------------- |
| **설정 간편성** | 매우 간단 (전원만 연결)                |
| **배선 수**     | 보통 3선                               |
| **노이즈 내성** | 전류 루프보다 낮음                     |
| **거리 제한**   | 짧은 거리 권장 (10~20m 이내)           |
| **단선 감지**   | 기본적으로 불가                        |
| **주로 사용처** | 실험실, 근거리 환경, 정밀 제어 장비 등 |

------

#### 📌 예시

| 입력 전압 | 디지털 값 (12bit 기준) |
| --------- | ---------------------- |
| 0V        | 0                      |
| 5V        | 2047                   |
| 10V       | 4095                   |

→ 디지털 값 = `(입력전압 / 10V) × 4095`

------

#### 📘 전압 입력 배선 예

```
[센서 출력 +] ────── PLC AI+
[GND]────────────── PLC AI-
```

- 단순 전압 분배 방식
- 차폐선(쉴드선) 필수

------

### ✅ 3. 전류 vs 전압 비교 요약

| 항목               | 전류 루프 (4~20mA) | 전압 입력 (0~10V)         |
| ------------------ | ------------------ | ------------------------- |
| **신호 안정성**    | ★★★★★ (우수)       | ★★★☆☆                     |
| **노이즈 내성**    | 우수               | 낮음                      |
| **배선 길이 영향** | 거의 없음          | 있음 (전압 강하)          |
| **단선 감지**      | 가능 (4mA 미만)    | 불가                      |
| **정밀도**         | 높음               | 보통                      |
| **회로 구성**      | 약간 복잡          | 간단                      |
| **적용 분야**      | 산업 현장 전반     | 실험실, 정밀 기기, 근거리 |

------

### ✅ 4. 설계 시 고려 사항

| 항목               | 체크포인트                        |
| ------------------ | --------------------------------- |
| PLC 입력 모듈 타입 | 전류 전용? 전압 전용? 혼용 가능?  |
| 센서 출력 타입     | 4~~20mA? 0~~10V? 둘 다 제공?      |
| 전송 거리          | 10m 이상은 전류 루프 권장         |
| 환경 노이즈        | 고주파기기 많은가? 쉴딩 가능한가? |
| 정밀도 요구        | 12bit 이상 필요한가?              |

------

### ✅ 5. 결론

- **전류 루프(4~20mA)**
   → **산업 자동화 표준**, 장거리/노이즈 강한 환경, 신뢰성 요구에 적합
- **전압 입력(0~10V)**
   → **근거리, 저렴한 설치**, 회로 단순한 환경에서 적합

## 7.3 센서(온도, 압력, 거리) 연동

*(PLC와 다양한 아날로그 센서를 연동하는 실전 기술 및 회로 구성)*

------

### ✅ 개요

PLC는 다양한 **물리량(온도, 압력, 거리 등)**을 측정하기 위해 센서와 연동하며,
 이들 센서는 대부분 **아날로그 출력(전압 or 전류)**을 사용한다.
 따라서 **정확한 센서 선택, 배선, 입력 범위 설정, 변환 수식 적용**이 중요하다.

------

### ✅ 1. 온도 센서 (Thermocouple, RTD, Analog Sensor)

------

#### 📌 종류별 개요

| 센서 종류          | 특징                     | 출력 방식                       | 사용 예        |
| ------------------ | ------------------------ | ------------------------------- | -------------- |
| Thermocouple       | 열기전력 기반, 고온 측정 | mV 출력 (비선형)                | 용광로, 히터   |
| RTD (Pt100)        | 저항 기반, 정밀          | 저항 값 (선형) → 전압 변환 필요 | 정밀 온도 제어 |
| Analog Temp Sensor | 0~~10V, 4~~20mA 출력     | PLC 직결 가능                   | 환경 온도 감시 |

------

#### 📘 RTD 예 (Pt100)

- 온도 변화에 따라 저항 변화
- RTD 모듈 필요 (3선식 RTD)
- Pt100 저항값: 0℃ = 100Ω, 100℃ = 약 138.5Ω

------

#### 📘 Analog 출력 센서 예

- 센서 사양:
   `0~100℃ → 4~20mA`
- PLC 아날로그 입력으로 직접 연동 가능

```
변환식:
온도 = ((입력 전류 - 4mA) / 16mA) × 100℃
```

------

### ✅ 2. 압력 센서 (Pressure Transmitter)

------

#### 📌 일반 사양

- 출력: **4~20mA** or **0~10V**
- 측정 범위: **0~10bar**, **0~100psi** 등
- 출력 선형 (직선 비례 관계)

------

#### 📘 예제

- 센서 스펙: `0~10bar → 4~20mA`
- PLC 아날로그 입력 값 = 2048 (12bit 기준)
   → 전류 = (2048 / 4095) × 16mA + 4mA ≈ 12mA
   → 압력 = ((12mA - 4mA) / 16mA) × 10bar = 5bar

------

#### 📌 배선

```
[센서 +24V]──────┬──── PLC AI+
                │
              [센서]
                │
[GND]───────────┴──── PLC AI-
```

- 쉴딩 필수, 접지 주의

------

### ✅ 3. 거리 센서 (Ultrasonic, Laser, Infrared 등)

------

#### 📌 센서 타입

| 종류             | 특징           | 출력                  |
| ---------------- | -------------- | --------------------- |
| 초음파 거리 센서 | 거리 측정 범용 | 0~~10V, 4~~20mA       |
| 레이저 거리 센서 | 정밀 측정      | 시리얼 통신 or 4~20mA |
| IR 센서          | 근접 검출용    | 전압 출력             |

------

#### 📘 예: 초음파 센서

- 출력: `0~2m → 0~10V`
- PLC 연결 후 변환:

```
거리 = (전압 / 10V) × 2m
```

- 출력: `0~3m → 4~20mA`

```
거리 = ((전류 - 4mA) / 16mA) × 3m
```

------

### ✅ 4. PLC 연동 절차 요약

1. **센서 선택**
   - 출력 타입 확인 (전압 vs 전류)
   - 측정 범위 확인
2. **PLC 입력 모듈 확인**
   - 전압 입력인지, 전류 입력인지 일치 여부 확인
3. **배선 구성**
   - 센서 전원 (24V) 공급
   - GND 공통
   - 쉴딩/접지 고려
4. **아날로그 입력 변환 수식 작성**
   - 전압/전류값 → 물리량으로 환산
5. **스케일링 처리**
   - 내부 변수 범위 (예: 0~4095) → 실제 단위로 매핑

------

### ✅ 5. PLC 내부 처리 예 (Structured Text)

```
// 12bit 입력 (0~4095), 0~100℃ → 4~20mA
// 아날로그 입력값: AI := 2048

Temp := ((AI / 4095.0) * 16.0 + 4.0 - 4.0) / 16.0 * 100.0;
```

------

### ✅ 6. 주의사항

| 주의 항목           | 설명                               |
| ------------------- | ---------------------------------- |
| **센서 전원 확인**  | 24V 필요 여부, 오픈 컬렉터 타입 등 |
| **출력 선형 여부**  | 일부 센서는 비선형 → 보정 필요     |
| **절연 여부**       | 센서와 PLC 간 절연 여부 확인       |
| **스케일링 일관성** | 스케일링 오류 시 제어값 왜곡       |

------

### ✅ 정리

- **온도/압력/거리 센서**는 PLC와 연동 시 출력 타입과 측정 범위 확인 필수
- **4~20mA 전류 출력**은 노이즈에 강하고 산업 현장에 적합
- **스케일링 변환 수식**과 **신호 안정성 확보**가 핵심
- PLC 내부 변수에 매핑하여 제어 로직에 통합 가능

## 7.4 PID 제어 구조

*(PLC에서 온도, 속도, 유량 등의 정밀한 제어를 위한 핵심 알고리즘)*

------

### ✅ 개요

PID 제어는 **Proportional(비례), Integral(적분), Derivative(미분)** 세 요소를 결합하여,
 제어 대상의 출력이 목표값(Setpoint)에 빠르게 도달하고 안정되도록 만드는 **피드백 제어 방식**이다.
 PLC에서는 **온도 제어, 압력 제어, 모터 속도 제어, 유량 제어** 등에 널리 사용된다.

------

### ✅ 1. PID 제어란?

PID 제어는 다음과 같은 수학식으로 표현된다:
$$
u(t) = K_p \cdot e(t) + K_i \cdot \int e(t) \, dt + K_d \cdot \frac{de(t)}{dt}
$$

- $u(t)$: 제어 출력
- $e(t) = SP - PV$: 오차 (Setpoint - Process Variable)
- $K_p$: 비례 이득
- $K_i$: 적분 이득
- $K_d$: 미분 이득

------

### ✅ 2. 각 요소의 역할

| 요소         | 설명                       | 주요 효과                  |
| ------------ | -------------------------- | -------------------------- |
| **P (비례)** | 현재 오차에 비례한 출력    | 빠른 반응 유도             |
| **I (적분)** | 오차의 누적에 따라 출력    | **잔류 오차 제거**         |
| **D (미분)** | 오차 변화 속도에 따라 출력 | **초과 응답 방지**, 안정화 |

------

### ✅ 3. PID 블록 구성 (PLC)

```
     +---------------------+
     |     PID Controller  |
     |                     |
SP → |–                    |→ MV (출력: 전류/전압/PWM)
     |     [P] [I] [D]     |
PV → |–                    |
     +---------------------+
```

- **SP**: 목표값 (Set Point) – 예: 100℃
- **PV**: 실제값 (Process Variable) – 예: 현재 온도
- **MV**: 제어 출력 (Manipulated Variable) – 예: 히터 전류, 인버터 주파수 등

------

### ✅ 4. PID 파라미터 조정

| 파라미터          | 설정 방법          | 효과                  |
| ----------------- | ------------------ | --------------------- |
| $K_p$ (비례 상수) | 높일수록 반응 빠름 | 너무 크면 진동 발생   |
| $K_i$ (적분 상수) | 낮출수록 안정적    | 너무 크면 오버슈트    |
| $K_d$ (미분 상수) | 진동 억제          | 너무 크면 노이즈 확대 |

------

#### 📌 자동 튜닝 기능

많은 PLC는 **자동 PID 튜닝** 기능을 제공
 → **Ziegler-Nichols** 방식이나 **Trial-and-Error** 기반으로 자동 조정

------

### ✅ 5. PID 제어 예시 (온도 제어)

- 목표 온도: 120℃
- 현재 온도(PV): 100℃
- PID 출력(MV): 0~100% (히터에 적용)

```
e := SP - PV;
P := Kp * e;
I := I + Ki * e * dt;
D := Kd * (e - e_prev) / dt;

MV := P + I + D;
```

→ MV는 히터의 SSR 제어, 인버터 출력, 아날로그 출력으로 사용됨

------

### ✅ 6. 실무 적용 분야

| 분야      | 제어 대상    | 설명                  |
| --------- | ------------ | --------------------- |
| 온도 제어 | 히터, 냉각팬 | 오븐, 금형, 환경 제어 |
| 압력 제어 | 밸브         | 공정 배관 압력 유지   |
| 속도 제어 | 인버터       | 모터 회전수 제어      |
| 유량 제어 | 펌프         | 정밀 유체 제어        |

------

### ✅ 7. PLC 내 PID 기능 사용법 (예: Siemens, LS, Mitsubishi)

- 전용 PID Function Block 제공 (예: `FB41` in Siemens)
- 입력값: SP, PV, P/I/D 계수
- 출력값: MV (PWM or Analog Output)

#### 📌 예 (Structured Text 형식)

```
PID(SP := 100.0,
    PV := SensorValue,
    Kp := 2.0,
    Ki := 1.0,
    Kd := 0.1,
    OUT => OutputValue);
```

------

### ✅ 8. 튜닝 시 고려사항

| 문제        | 원인         | 대응              |
| ----------- | ------------ | ----------------- |
| 진동 발생   | Kp 너무 큼   | P 감소, D 증가    |
| 느린 반응   | Kp 너무 작음 | P 증가            |
| 오버슈트    | Ki 너무 큼   | I 감소            |
| 노이즈 민감 | D 너무 큼    | D 감소, 필터 추가 |

------

### ✅ 9. 고급 기법

| 기법                  | 설명                      |
| --------------------- | ------------------------- |
| **Cascade PID**       | 이중 루프 구조 (1차+2차)  |
| **Feed-forward 제어** | 외란 예측 기반 추가 보정  |
| **Gain Scheduling**   | 구간별 PID 계수 자동 전환 |
| **Fuzzy PID**         | 퍼지 논리와 결합된 PID    |

------

### ✅ 정리

- PID는 **정밀한 목표값 유지**에 필수적인 제어 구조
- PLC에서는 PID 기능 블록으로 간편하게 구현 가능
- P/I/D 계수는 반드시 **적절히 조정**해야 진동 없이 빠른 응답이 가능
- 다양한 물리량 제어에 널리 활용됨

## 7.5 스케일링/디스케일링 처리

*(센서 입력값과 실제 물리량 간의 환산을 자동화하는 PLC의 핵심 기법)*

------

### ✅ 개요

센서의 아날로그 출력(전압 또는 전류)은 **디지털 값(Digital Input: 0~4095 등)**으로 PLC에 입력된다.
 이 입력값은 실제 물리적 단위(℃, bar, mm 등)와 일치하지 않기 때문에,
 **스케일링(Scaling)** 및 **디스케일링(De-scaling)** 과정을 통해 정확한 값으로 변환해야 한다.

------

### ✅ 1. 정의

| 용어                       | 설명                                                   |
| -------------------------- | ------------------------------------------------------ |
| **스케일링(Scaling)**      | 아날로그 입력값을 실제 물리량으로 변환                 |
| **디스케일링(De-scaling)** | 제어 값을 아날로그 출력 신호로 변환 (ex: 0~10V로 출력) |

------

### ✅ 2. 스케일링 공식

아날로그 입력값 `RawInput`을 실물값으로 바꾸는 공식은 다음과 같다:
$$
\text{RealValue} = \frac{(RawInput - InMin)}{(InMax - InMin)} \times (RealMax - RealMin) + RealMin
$$

- `RawInput`: 아날로그 입력값 (예: 0~4095)
- `InMin`, `InMax`: 입력값의 범위
- `RealMin`, `RealMax`: 변환할 실제 물리량의 범위

------

#### 📌 예제 1: 0~10V 입력 → 0~100℃ 온도

- PLC 아날로그 입력값: 0~4095
- 전압 입력 센서: 0~10V → 0~100℃
- 현재 입력값: 2048

$$
RealValue = (2048 - 0) / (4095 - 0) × (100 - 0) + 0 ≈ 50℃
$$

------

#### 📌 예제 2: 4~20mA 입력 → 0~5000L 유량

- PLC Raw 값 범위: 0~4095
- 4mA = 0L, 20mA = 5000L
- 대응하는 디지털 입력:
  - 4mA → 약 820
  - 20mA → 4095

$$
RealValue = (Raw - 820) / (3275) × 5000
$$

→ 3275 = 4095 - 820

------

### ✅ 3. 디스케일링 공식 (출력용)

제어 출력값 `RealOutput`을 아날로그 출력 범위로 환산:
$$
\text{RawOutput} = \frac{(RealOutput - RealMin)}{(RealMax - RealMin)} \times (OutMax - OutMin) + OutMin
$$

- **PWM / Analog 출력 시 사용**
- 예: 0~100% 제어 → 4~20mA 출력

------

#### 📌 예제: 0~100% 제어값 → 4~20mA 출력

$$
RawOutput = (75 - 0) / (100 - 0) × (4095 - 820) + 820 ≈ 3270
$$

→ 75% 제어 시 출력 전류 = 약 16.7mA

------

### ✅ 4. PLC에서의 구현 예 (Structured Text)

```
// Scaling 예
AnalogIn := AI0; // 0~4095
Temp_C := (AnalogIn / 4095.0) * 100.0;

// De-scaling 예
Control := 75.0; // 0~100%
AnalogOut := (Control / 100.0) * 3275 + 820;
```

------

### ✅ 5. 전용 함수 블록 사용 (PLC 브랜드별)

| 제조사        | 함수 이름                            |
| ------------- | ------------------------------------ |
| Siemens       | `SCALE`, `UNSCALE`, `FC105`, `FC106` |
| LS            | `SCALE_REAL`, `LIMIT`, `MATH`        |
| Mitsubishi    | `SCL2`, `REV_SCL2`                   |
| Allen Bradley | `SCP` (Scale with Parameters)        |

------

#### 📘 Siemens 예 (FC105)

```
SCALE(
  IN := AI,
  HI_LIM := 100.0,
  LO_LIM := 0.0,
  BIPOLAR := FALSE,
  RET_VAL := STATUS,
  OUT := TEMP_C
);
```

------

### ✅ 6. 스케일링 처리 시 유의사항

| 항목                            | 설명                                   |
| ------------------------------- | -------------------------------------- |
| **센서 사양 정확히 확인**       | 출력 범위 정확히 알고 있어야 계산 가능 |
| **해상도 오차 고려**            | 예: 12bit → ±0.025% 정도의 오차 존재   |
| **아날로그 노이즈 필터링**      | 이동 평균 / 저역통과필터 사용 권장     |
| **디스케일링 후 포화제한 적용** | 4~20mA 제한 내에서 Clip 처리 필요      |

------

### ✅ 7. 정리

- 센서 입력은 대부분 **디지털 값**으로 수집되므로 **스케일링이 필수**
- 출력 제어를 위한 디스케일링도 함께 구현해야 함
- 수동 계산, 함수 블록, Structured Text 등으로 구현 가능
- **정확한 센서 스펙 파악**과 **비례 계산**이 핵심

## 7.6 Analog Alarm 설정

*(센서값이 특정 범위를 벗어났을 때 경고를 발생시키는 실전 감시 기법)*

------

### ✅ 개요

**Analog Alarm**은 온도, 압력, 유량 등과 같은 연속적인 물리량이 특정 임계값을 초과하거나 미달할 경우
 **경고(Alarm), 에러(Trip), 차단(Interlock)** 등을 트리거하기 위한 **PLC 기반의 감시 로직**이다.

이 기능은 **산업 현장의 안정성**과 **장비 보호**를 위해 반드시 구현해야 하는 핵심 보호 장치 중 하나다.

------

### ✅ 1. 알람의 종류

| 알람 유형          | 설명             | 예시                        |
| ------------------ | ---------------- | --------------------------- |
| **High High (HH)** | 극단적 고값 초과 | 압력 > 8.0bar → 긴급정지    |
| **High (H)**       | 일반적 고값 초과 | 압력 > 6.0bar → 경고등 점등 |
| **Low (L)**        | 일반적 저값 미만 | 온도 < 10℃ → 예열 활성화    |
| **Low Low (LL)**   | 극단적 저값 미만 | 유량 < 0.5L/min → 펌프 차단 |

> 보통 **H/HH** 또는 **L/LL** 두 단계로 설계하며,
>  **주의(Warning) → 정지(Trip)** 순으로 이어지는 구조가 일반적이다.

------

### ✅ 2. 기본 로직 구조

```
// 예: 압력 센서 (0~10 bar)
IF Pressure > 8.0 THEN
    HH_Alarm := TRUE;
ELSIF Pressure > 6.0 THEN
    H_Alarm := TRUE;
ELSE
    H_Alarm := FALSE;
    HH_Alarm := FALSE;
END_IF;
```

------

### ✅ 3. 히스테리시스(Hysteresis) 적용

센서값이 임계값에서 **출렁이며 알람이 반복 발생**하지 않도록,
 일정한 **여유값(ΔH)**을 적용하여 **알람 진입/해제 조건을 분리**한다.

```
// H 알람: 진입 6.0bar / 해제 5.8bar
IF Pressure > 6.0 THEN
    H_Alarm := TRUE;
ELSIF Pressure < 5.8 THEN
    H_Alarm := FALSE;
END_IF;
```

------

### ✅ 4. 알람 상태 유지 (라칭, Reset 포함)

알람 발생 후 사용자가 **Reset 버튼**을 누를 때까지 유지하는 구조:

```
IF Pressure > 8.0 THEN
    HH_Alarm := TRUE;
END_IF;

IF ResetButton = TRUE THEN
    HH_Alarm := FALSE;
END_IF;
```

------

### ✅ 5. PLC 실전 구현 예 (Structured Text)

```
// 예: 온도 센서 (0~100℃)
IF Temp >= 90.0 THEN
    Alarm_HH := TRUE;
ELSIF Temp <= 10.0 THEN
    Alarm_LL := TRUE;
END_IF;

// 히스테리시스
IF Temp < 88.0 THEN
    Alarm_HH := FALSE;
END_IF;
IF Temp > 12.0 THEN
    Alarm_LL := FALSE;
END_IF;
```

------

### ✅ 6. 알람 이벤트 출력

| 구성 요소         | 구현 방식                                  |
| ----------------- | ------------------------------------------ |
| **알람 표시등**   | 디지털 출력으로 LED 점등                   |
| **HMI 연동**      | 내부 태그(BOOL)로 알람 발생 전달           |
| **버저 / 사이렌** | 알람 유지 시 ON                            |
| **로그 저장**     | 알람 발생 시 시간 및 PV 저장 (추후 분석용) |

------

### ✅ 7. 다중 알람 처리 구조 예

```
CASE TRUE OF
    Temp > 90.0:  AlarmLevel := 'HH';
    Temp > 80.0:  AlarmLevel := 'H';
    Temp < 5.0:   AlarmLevel := 'LL';
    Temp < 10.0:  AlarmLevel := 'L';
    ELSE          AlarmLevel := 'NORMAL';
END_CASE;
```

------

### ✅ 8. 주의사항

| 항목                  | 설명                               |
| --------------------- | ---------------------------------- |
| 센서 이상값 필터링    | 센서 단선 시 알람 오작동 방지      |
| 입력 노이즈 처리      | 필터링 후 알람 적용 (이동 평균 등) |
| 상태 유지 조건 명확히 | 자동 해제 vs 수동 해제 분리        |
| 기록 및 알림 이력     | 시간 스탬프 저장, HMI 표시 연동    |

------

### ✅ 9. 실무 예시 요약

| 항목      | 목표       | 알람 조건                  | 조치                   |
| --------- | ---------- | -------------------------- | ---------------------- |
| 유량 제어 | 5~10 L/min | <3.0 (LL), >12.0 (HH)      | 펌프 정지, 벨브 차단   |
| 온도 제어 | 20~80℃     | <10℃ (L), >90℃ (H)         | 히터 켜기, 냉각기 작동 |
| 압력 제어 | 1~6 bar    | <0.5bar (LL), >8.0bar (HH) | 압력해제밸브 작동      |

------

### ✅ 정리

- 아날로그 알람은 **상한/하한 조건을 감시**하여 설비 안정성 확보에 필수
- **히스테리시스와 상태 유지** 로직은 꼭 구현할 것
- **HMI, 로그, 경고등, 음향 장치** 등 다양한 출력 장치와 연동 가능
- **알람 이력 저장과 분석**은 추후 유지보수 및 품질 개선에 핵심 자료

